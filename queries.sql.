SELECT
    CONCAT(e.first_name, ' ', e.last_name) AS seller,
    COUNT(s.sales_id) AS operations,
    FLOOR(SUM(s.quantity * p.price)) AS income
FROM employees e
JOIN sales s ON s.sales_person_id = e.employee_id
JOIN products p ON p.product_id = s.product_id
GROUP BY e.employee_id, e.first_name, e.last_name
ORDER BY income DESC
LIMIT 10;

запрос 1
Объединяет таблицы employees, sales и products, чтобы узнать, кто что продал и за сколько.
Считает для каждого сотрудника:
его полное имя (seller),
количество продаж (operations),
суммарный доход от продаж (income).
Группирует данные по сотруднику.
Сортирует по доходу от большего к меньшему.
Берёт только топ-10 продавцов по доходу.

WITH seller_stats AS (
    SELECT
        e.employee_id,
        CONCAT(e.first_name, ' ', e.last_name) AS seller,
        FLOOR(AVG(s.quantity * p.price)) AS avg_income_seller
    FROM employees e
    JOIN sales s ON s.sales_person_id = e.employee_id
    JOIN products p ON p.product_id = s.product_id
    GROUP BY e.employee_id, e.first_name, e.last_name
),
overall_avg AS (
    SELECT FLOOR(AVG(avg_income_seller)) AS avg_income_all
    FROM seller_stats
)
SELECT
    seller,
    avg_income_seller AS average_income
FROM seller_stats, overall_avg
WHERE avg_income_seller < avg_income_all
ORDER BY average_income ASC;

запрос 2
В первом подзапросе (seller_stats) для каждого сотрудника вычисляет средний доход от одной продажи.
Во втором подзапросе (overall_avg) считает средний доход по всем продавцам.
В основном запросе выбирает всех продавцов, чей средний доход ниже среднего по всем.
Сортирует этих сотрудников по возрастанию среднего дохода.
То есть этот запрос ищет «слабых» продавцов по среднему доходу.

SELECT
    CONCAT(e.first_name, ' ', e.last_name) AS seller,
    LOWER(TRIM(TO_CHAR(s.sale_date, 'Day'))) AS day_of_week,
    FLOOR(SUM(s.quantity * p.price)) AS income
FROM employees e
JOIN sales s ON s.sales_person_id = e.employee_id
JOIN products p ON p.product_id = s.product_id
GROUP BY
    e.employee_id,
    e.first_name,
    e.last_name,
    TO_CHAR(s.sale_date, 'D'),
    TO_CHAR(s.sale_date, 'Day')
ORDER BY
    TO_CHAR(s.sale_date, 'D'),
    seller;

запрос 3
Объединяет таблицы сотрудников, продаж и товаров.
Для каждого сотрудника и дня недели считает:
его имя (seller),
день недели продажи (day_of_week),
суммарный доход за этот день (income).
Группирует данные по сотруднику и дню недели.
Сортирует сначала по дню недели, потом по имени продавца.
То есть показывает, сколько каждый продавец заработал в каждый день недели.
